{% extends 'home/base.html' %}

{% block title %}
Profile
{% endblock %}

{% block content %}
<div class="container mt-4">
    <h2>Update Profile</h2>
    <form method="post" enctype="multipart/form-data">
        {% csrf_token %}
        <div class="form-row">
            <div class="form-group col-md-6">
                Name:
                {{ profile_form.name }}
            </div>
            <div class="form-group col-md-6">
                Email:
                {{ profile_form.email }}
            </div>
        </div>
        <div class="form-row">
            <div class="form-group col-md-6">
                Locale:
                {{ profile_form.locale }}
            </div>
            <div class="form-group col-md-6">
                Headline:
                {{ profile_form.headline }}
            </div>
        </div>
        <div class="form-row">
            <div class="form-group col-md-6">
                Date of Birth:
                {{ profile_form.date_of_birth }}
            </div>
            <div class="form-group col-md-6">
                Address:
                {{ profile_form.address }}
            </div>
        </div>
        <div class="form-row">
            <div class="form-group col-md-6">
                Phone Number:
                {{ profile_form.phone_number }}
            </div>
            <div class="form-group col-md-6">
                Profile Photo:
                {{ profile_form.profile_photo }}
            </div>
        </div>
        <button type="submit" name="profile_submit" class="btn btn-primary">Save Profile</button>
    </form>
    <br />
    <h3>Education</h3>
    <form method="post">
        {% csrf_token %}
        {{ education_formset.management_form }}
        <table class="table">
            <thead>
                <tr>
                    <th>Level</th>
                    <th>Marks/CGPA</th>
                    <th>Year of Passing</th>
                    <th>Board/University</th>
                    <th>Degree</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody>
                {% for form in education_formset %}
                <tr>
                    <td>{{ form.level }}</td>
                    <td>{{ form.marks_or_cgpa }}</td>
                    <td>{{ form.year_of_passing }}</td>
                    <td>{{ form.board_or_university }}</td>
                    <td>{{ form.degree }}</td>
                    <td>
                        {% if forloop.first %}
                            <button type="button" class="btn btn-secondary add-education">Add More</button>
                        {% else %}
                            <button type="button" class="btn btn-danger remove-education">Remove</button>
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        <button type="submit" name="education_submit" class="btn btn-primary">Save Education</button>
    <br />

        </form>
    <br />

    <a href="{% url 'generate_pdf' %}" class="btn btn-primary">Download Information (PDF)</a>
</div>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const addEducationButton = document.querySelector('.add-education');
        const educationTable = document.querySelector('table tbody');
        
        addEducationButton.addEventListener('click', function() {
            const lastEducationRow = educationTable.querySelector('tr:last-child');
            const newEducationRow = lastEducationRow.cloneNode(true);
            const inputs = newEducationRow.querySelectorAll('input, select');
            
            inputs.forEach(input => {
                const name = input.getAttribute('name');
                const newName = name.replace(/\d+/, function(match) {
                    return parseInt(match) + 1;
                });
                input.setAttribute('name', newName);
                input.value = '';
            });
            
            educationTable.appendChild(newEducationRow);
        });
        
        educationTable.addEventListener('click', function(event) {
            if (event.target.classList.contains('remove-education')) {
                const row = event.target.closest('tr');
                row.remove();
            }
        });
    });
</script>
{% endblock %}
